<div class="container mx-auto p-6">
  
  <!-- Header Section -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Raw Materials</h1>
    
    <!-- Button to toggle form -->
    <button
      class="px-5 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
      (click)="toggleCreateForm()"
    >
      <span *ngIf="!showCreateForm()">‚ûï Add Material</span>
      <span *ngIf="showCreateForm()">‚úñÔ∏è Close Form</span>
    </button>
  </div>

  <!-- Inline Create Raw Material Form -->
  <div *ngIf="showCreateForm()" 
       class="bg-white border rounded-lg shadow-sm p-6 mb-6">

    <h3 class="text-lg font-semibold text-gray-800 mb-4">
      Create New Raw Material
    </h3>

    <!-- Error -->
    <div *ngIf="error()" class="mb-4 p-3 rounded bg-red-50 text-red-700 text-sm">
      {{ error() }}
    </div>

    <!-- Success -->
    <div *ngIf="success()" class="mb-4 p-3 rounded bg-green-50 text-green-700 text-sm">
      Raw material created successfully
    </div>

    <form (ngSubmit)="createRawMaterial()" class="grid grid-cols-1 md:grid-cols-3 gap-4">

      <!-- Name -->
      <input type="text" [(ngModel)]="name" name="name" required placeholder="Name"
        class="rounded-lg border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-2 border"/>

      <!-- Stock -->
      <input type="number" [(ngModel)]="stock" name="stock" min="0" placeholder="Stock"
        class="rounded-lg border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-2 border"/>

      <!-- Min Stock -->
      <input type="number" [(ngModel)]="stockMin" name="stockMin" min="0" placeholder="Min Stock"
        class="rounded-lg border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-2 border"/>

      <!-- Unit Price -->
      <input type="number" [(ngModel)]="unitPrice" name="unitPrice" min="0" step="0.01" placeholder="Unit Price"
        class="rounded-lg border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-2 border"/>

      <!-- Unit -->
      <select [(ngModel)]="unit" name="unit"
        class="rounded-lg border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-2 border">
        <option value="piece">Piece</option>
        <option value="kg">Kg</option>
        <option value="liter">Liter</option>
      </select>

      <!-- Description -->
      <textarea [(ngModel)]="description" name="description" placeholder="Description"
        class="md:col-span-3 rounded-lg border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 px-4 py-2 border"
        rows="3"></textarea>

      <!-- Actions -->
      <div class="md:col-span-3 flex justify-end gap-3 mt-2">
        <button type="button" class="px-4 py-2 rounded bg-gray-100 hover:bg-gray-200 transition"
          (click)="toggleCreateForm()">
          Cancel
        </button>

        <button type="submit" [disabled]="loading()"
          class="px-6 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50 transition">
          {{ loading() ? 'Creating...' : 'Create' }}
        </button>
      </div>

    </form>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading() && rawMaterials().length === 0" class="text-center py-12">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
    <p class="mt-2 text-gray-600">Loading raw materials...</p>
  </div>

  <!-- Error State (when list fails to load) -->
  <div *ngIf="error() && rawMaterials().length === 0 && !showCreateForm()" 
       class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
    <p class="text-red-700">{{ error() }}</p>
    <button (click)="loadRawMaterials()" 
            class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
      Retry
    </button>
  </div>

  <!-- Raw Materials List -->
  <div *ngIf="rawMaterials().length > 0" class="bg-white rounded-lg shadow-sm overflow-hidden">
    
    <!-- Table Header -->
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Name
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Description
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Stock
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Min Stock
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Unit Price
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Unit
            </th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let material of rawMaterials()" class="hover:bg-gray-50 transition">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">{{ material.name }}</div>
            </td>
            <td class="px-6 py-4">
              <div class="text-sm text-gray-600">{{ material.description || '‚Äî' }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="text-sm text-gray-900" 
                    [class.text-red-600]="material.stock < material.stockMin">
                {{ material.stock }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="text-sm text-gray-600">{{ material.stockMin }}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="text-sm text-gray-900">{{ material.unitPrice | number:'1.2-2' }}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">
                {{ material.unit }}
              </span>
            </td>
            
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
          <div class="flex justify-end gap-3">
        
            <button (click)="onEdit(material.id)"
                    class="inline-flex items-center px-3 py-1.5 bg-indigo-50 text-indigo-600 border border-indigo-200 rounded-md hover:bg-indigo-600 hover:text-white transition-colors duration-200 disabled:opacity-50"
                    [disabled]="loading()">
              <span class="mr-1">‚úèÔ∏è</span> Edit
            </button>

            <!-- Delete Button: Red -->
            <button (click)="delete(material.id)"
                    class="inline-flex items-center px-3 py-1.5 bg-red-50 text-red-600 border border-red-200 rounded-md hover:bg-red-600 hover:text-white transition-colors duration-200 disabled:opacity-50"
                    [disabled]="loading()">
              <span class="mr-1">üóëÔ∏è</span> Delete
            </button>
          </div>
        </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200">
      <div class="text-sm text-gray-700">
        Showing <span class="font-medium">{{ rawMaterials().length }}</span> of 
        <span class="font-medium">{{ totalElements() }}</span> results
      </div>
      
      <div class="flex gap-2">
        <button (click)="previousPage()" 
                [disabled]="pageNumber() === 0 || loading()"
                class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition">
          Previous
        </button>
        
        <span class="px-4 py-2 text-sm text-gray-700">
          Page {{ pageNumber() + 1 }} of {{ totalPages() }}
        </span>
        
        <button (click)="nextPage()" 
                [disabled]="pageNumber() + 1 >= totalPages() || loading()"
                class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition">
          Next
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="rawMaterials().length === 0 && !loading() && !error()" 
       class="bg-white rounded-lg shadow-sm p-12 text-center">
    <div class="text-gray-400 text-5xl mb-4">üì¶</div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No raw materials yet</h3>
    <p class="text-gray-600 mb-4">Get started by creating your first raw material.</p>
    <button (click)="toggleCreateForm()"
            class="px-5 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
      ‚ûï Add Material
    </button>
  </div>

</div>